<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ð’Ñ…Ð¾Ð´ â€” MurodTrader</title>
    
    <!-- ðŸš« ÐŸÐžÐ›ÐÐžÐ• ÐžÐ¢ÐšÐ›Ð®Ð§Ð•ÐÐ˜Ð• ÐšÐ•Ð¨Ð˜Ð ÐžÐ’ÐÐÐ˜Ð¯ -->
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="./assets/css/login-style.css">
</head>
<body style="background: var(--bg-primary);">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        function LoginPage() {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            // ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÐ¼ URL Ð´Ð»Ñ API (Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð¸ Ñ Netlify Ð¸ Ñ Vercel)
            const getApiUrl = () => {
                const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð° ÐºÐ°ÐºÐ¾Ð¼ ÑÐµÑ€Ð²Ð¸ÑÐµ Ð¼Ñ‹
                const isVercel = window.location.hostname.includes('vercel.app');
                
                if (isLocal) {
                    return `http://localhost:${window.location.port || 9999}/api/auth`;
                } else if (isVercel) {
                    return '/api/auth';
                } else {
                    return '/.netlify/functions/auth';
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!username.trim() || !password.trim()) {
                    setError('Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¸Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¸ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ');
                    return;
                }

                setIsLoading(true);
                setError('');

                try {
                    // Ð”Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ - Ð¿Ñ€Ð¾ÑÑ‚Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°
                    const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                    
                    if (isLocal) {
                        // Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
                        const VALID_USERNAME = 'trader';
                        const VALID_PASSWORD = 'Murod777';
                        
                        if (username === VALID_USERNAME && password === VALID_PASSWORD) {
                            sessionStorage.setItem('cryptoview_loggedIn', 'true');
                            sessionStorage.setItem('auth_token', btoa(`${username}:${Date.now()}`));
                            window.location.href = 'home.html';
                            return;
                        } else {
                            setError('ÐÐµÐ²ÐµÑ€Ð½Ð¾Ðµ Ð¸Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¸Ð»Ð¸ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ');
                            setIsLoading(false);
                            return;
                        }
                    }
                    
                    // Ð”Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð° - Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Netlify Function
                    const response = await fetch(getApiUrl(), {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ username, password })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ‚Ð¾ÐºÐµÐ½ Ð² sessionStorage
                        sessionStorage.setItem('cryptoview_loggedIn', 'true');
                        sessionStorage.setItem('auth_token', data.token);
                        window.location.href = 'home.html';
                    } else {
                        setError(data.message || 'ÐÐµÐ²ÐµÑ€Ð½Ð¾Ðµ Ð¸Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¸Ð»Ð¸ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ');
                    }
                } catch (err) {
                    setError('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐµ Ð´Ð°Ð½Ð½Ñ‹Ñ…');
                    console.error('Login error:', err);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                React.createElement('div', { className: 'react-login-modal' },
                    React.createElement('div', { className: 'react-login-background' }),
                    React.createElement('div', { className: 'react-login-container' },
                        React.createElement('h2', { className: 'react-login-title' }, 'MurodTrader'),
                        React.createElement('p', { className: 'react-login-subtitle' }, 'Ð’Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐµ ÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð²Ð°Ð»ÑŽÑ‚'),
                        React.createElement('form', { className: 'react-login-form', onSubmit: handleSubmit },
                            React.createElement('div', { className: 'react-form-group' },
                                React.createElement('label', { className: 'react-form-label', htmlFor: 'react-username' }, 'Ð˜Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ'),
                                React.createElement('input', {
                                    type: 'text', id: 'react-username', className: 'react-form-input',
                                    value: username, onChange: (e) => setUsername(e.target.value),
                                    placeholder: 'Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¸Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ', required: true,
                                    disabled: isLoading, autoComplete: 'username'
                                })
                            ),
                            React.createElement('div', { className: 'react-form-group' },
                                React.createElement('label', { className: 'react-form-label', htmlFor: 'react-password' }, 'ÐŸÐ°Ñ€Ð¾Ð»ÑŒ'),
                                React.createElement('input', {
                                    type: 'password', id: 'react-password', className: 'react-form-input',
                                    value: password, onChange: (e) => setPassword(e.target.value),
                                    placeholder: 'Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ', required: true, disabled: isLoading,
                                    autoComplete: 'current-password'
                                })
                            ),
                            React.createElement('button', { type: 'submit', className: 'react-login-btn', disabled: isLoading }, isLoading ? 'ðŸ”„ Ð’Ñ…Ð¾Ð´...' : 'Ð’Ð¾Ð¹Ñ‚Ð¸'),
                            error && React.createElement('div', { className: 'react-login-error' }, error)
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(LoginPage));
    </script>
</body>
</html>


